{?xml version="1.0"?}
{Jelly}
	
	{!-- Item Template "XML Item" --}
		{Template}
			{Type}Item{/Type}
			{Name}XML Item{/Name}
			{Content_Type}text/xml{/Content_Type}
			{Content}
				[Set Current_Item to This /]
				[Set Current_Type to Current_Item.Type /]

				<!-- [Current_Type.Name No_Wrap /] "[Current_Item.Name No_Wrap /]" (ID: [Current_Item.ID No_Wrap /]) -->
				<[Current_Type.Alias no_wrap /]>[Clean Whitespace]
						[Current_Item.Forward_Property where Relation is not "Many-To-Many" and (Type is not "Type" or Relation is not "One-To-Many")][Clean Whitespace]
							[Set Current_Property to This /]
							[If Current_Property.Relation is ""]
								[Then][Clean Whitespace]
									[Ignore]<!-- TODO - this should work for simple types too down the road, maybe via format? and not require this if-->[/Ignore]
									[If Current_Property.Value_Type.Alias = "Date" or Current_Property.Value_Type.Alias = "Date_Time" or Current_Property.Value_Type.Alias = "Time"]
										[Then]
					[Clean Whitespace][If Current_Item.Values.[Current_Property.Alias No_Wrap /] exists]<[Current_Property.Alias No_Wrap /]>[Format as "XML Data"][Current_Item.Values.[Current_Property.Alias No_Wrap /]][This as XML_Value Process_Once No_Wrap /][/] [/Format]</[Current_Property.Alias No_Wrap /]>[/If]
										[/Clean][/Then]
										[Else]
					[Clean Whitespace]<[Current_Property.Alias No_Wrap /]>[Format as "XML Data"][Current_Item.Values.[Current_Property.Alias No_Wrap /] Process_Once No_Wrap /][/Format]</[Current_Property.Alias No_Wrap /]>
										[/Clean][/Else]
									[/If]
								[/Clean][/Then]
								[Else][Clean Whitespace]
									[Current_Item.Values.[Current_Property.Alias No_Wrap /]][Clean Whitespace]
										[Set Current_Value to This/]
										[If 
											Current_Value.Type.Alias = "Property" or
											Current_Value.Type.Alias = "Template" or 
											Current_Value.Type.Alias = "Type_Action" or
											Current_Value.Type.Alias = "Type"
										]
											[Then]
					[Clean Whitespace]<[Current_Property.Alias no_wrap /]>[/Clean]
						[Clean Whitespace]<ID>[Format as "XML Data"][This.ID no_wrap /][/Format]</ID>[/Clean]
						[Clean Whitespace]<Alias>[Format as "XML Data"][This.Alias no_wrap /][/Format]</Alias>[/Clean]
						[Clean Whitespace]<Meta_Type>[Format as "XML Data"][This.Type.Alias no_wrap /][/Format]</Meta_Type>[/Clean]
						[If Current_Value.Type.Alias != "Type"][Clean Whitespace]<Type>[Format as "XML Data"][This.Values.Type.Alias no_wrap /][/Format]</Type>[/Clean][/If]
					[Clean Whitespace]</[Current_Property.Alias no_wrap /]>
											[/Clean][/Then]
											[Else][Clean Whitespace]
												[If Current_Property.Value_Type.Alias = "Item"]
													[Then]
					[Clean Whitespace]<[Current_Property.Alias no_wrap /]>[Format as "XML Data"][This.ID no_wrap /][/Format]</[Current_Property.Alias no_wrap /]>
											[/Clean][/Then]
													[Else]
					[Clean Whitespace]<[Current_Property.Alias no_wrap /]>[Format as "XML Data"][This.[Current_Property.Key No_Wrap /] /][/Format]</[Current_Property.Alias no_wrap /]>
													[/Clean][/Else]
												[/If]
											[/Clean][/Else]
										[/If]
									[/Clean][/Current_Item.Values.[Current_Property.Alias No_Wrap /]]
								[/Clean][/Else]
							[/If]
						[/Clean][/Current_Item.Forward_Property]
	
						[Current_Item.Reverse_Property where Type = "Type" and Relation = "One-To-Many"][Clean Whitespace]
							[Set Current_Property to This /]
							[Current_Item.Values.[Current_Property.Reverse_Alias No_Wrap /]]
					[Clean Whitespace]
								[Set Current_Value to This/]
						[Clean Whitespace]<[Current_Property.Reverse_Alias no_wrap /]>[/Clean]
						[Clean Whitespace]<ID>[Format as "XML Data"][This.ID no_wrap /][/Format]</ID>[/Clean]
						[Clean Whitespace]<Alias>[Format as "XML Data"][This.Alias no_wrap /][/Format]</Alias>[/Clean]
						[Clean Whitespace]<Meta_Type>[Format as "XML Data"][This.Type.Alias no_wrap /][/Format]</Meta_Type>[/Clean]
						[If Current_Value.Type.Alias != "Type"][Clean Whitespace]<Type>[Format as "XML Data"][This.Values.Type.Alias no_wrap /][/Format]</Type>[/Clean][/If]
						[Clean Whitespace]</[Current_Property.Reverse_Alias no_wrap /]>[/Clean]
							[/Clean][/Current_Item.Values.[Current_Property.Reverse_Alias No_Wrap /]]	
						[/Clean][/Reverse_Property]

						[Current_Item.Attachment_Property][Clean Whitespace]
							[Set Current_Property to This /]
							[Current_Item.Values.[Current_Property.Alias No_Wrap /]][Clean Whitespace]
								[Set Current_Value to This/]
								[If 
									Current_Value.Type.Alias = "Property" or
									Current_Value.Type.Alias = "Template" or 
									Current_Value.Type.Alias = "Type_Action" or
									Current_Value.Type.Alias = "Type"
								]
									[Then]
					[Clean Whitespace]<[Current_Property.Alias no_wrap /]>[/Clean]
						[Clean Whitespace]<ID>[Format as "XML Data"][This.ID no_wrap /][/Format]</ID>[/Clean]
						[Clean Whitespace]<Alias>[Format as "XML Data"][This.Alias no_wrap /][/Format]</Alias>[/Clean]
						[Clean Whitespace]<Meta_Type>[Format as "XML Data"][This.Type.Alias no_wrap /][/Format]</Meta_Type>[/Clean]
						[If Current_Value.Type.Alias != "Type"][Clean Whitespace]<Type>[Format as "XML Data"][This.Values.Type.Alias no_wrap /][/Format]</Type>[/Clean][/If]
					[Clean Whitespace]</[Current_Property.Alias no_wrap /]>
									[/Clean][/Then]
									[Else][Clean Whitespace]
										[If Current_Property.Value_Type.Alias = "Item"]
											[Then]
					[Clean Whitespace]<[Current_Property.Alias no_wrap /]>[Format as "XML Data"][This.ID no_wrap /][/Format]</[Current_Property.Alias no_wrap /]>
											[/Clean][/Then]
											[Else]
					[Clean Whitespace]<[Current_Property.Alias no_wrap /]>[Format as "XML Data"][This.[Current_Property.Key No_Wrap /] /][/Format]</[Current_Property.Alias no_wrap /]>
											[/Clean][/Else]
										[/If]
									[/Clean][/Else]
								[/If]
							[/Clean][/Current_Item.Values.[Current_Property.Alias No_Wrap /]]
							[Current_Item.Values.[Current_Property.Reverse_Alias No_Wrap /]][Clean Whitespace]
								[Set Current_Value to This/]
								[If 
									Current_Value.Type.Alias = "Property" or
									Current_Value.Type.Alias = "Template" or 
									Current_Value.Type.Alias = "Type_Action" or
									Current_Value.Type.Alias = "Type"
								]
									[Then]
					[Clean Whitespace]<[Current_Property.Reverse_Alias no_wrap /]>[/Clean]
						[Clean Whitespace]<ID>[Format as "XML Data"][This.ID no_wrap /][/Format]</ID>[/Clean]
						[Clean Whitespace]<Alias>[Format as "XML Data"][This.Alias no_wrap /][/Format]</Alias>[/Clean]
						[Clean Whitespace]<Meta_Type>[Format as "XML Data"][This.Type.Alias no_wrap /][/Format]</Meta_Type>[/Clean]
						[If Current_Value.Type.Alias != "Type"][Clean Whitespace]<Type>[Format as "XML Data"][This.Values.Type.Alias no_wrap /][/Format]</Type>[/Clean][/If]
					[Clean Whitespace]</[Current_Property.Reverse_Alias no_wrap /]>
									[/Clean][/Then]
									[Else][Clean Whitespace]
										[If Current_Property.Values.Type.Alias = "Item"]
											[Then]
					[Clean Whitespace]<[Current_Property.Reverse_Alias no_wrap /]>[Format as "XML Data"][This.ID no_wrap /][/Format]</[Current_Property.Reverse_Alias no_wrap /]>
											[/Clean][/Then]
											[Else]
					[Clean Whitespace]<[Current_Property.Reverse_Alias no_wrap /]>[Format as "XML Data"][This.[Current_Property.Reverse_Key No_Wrap /] /][/Format]</[Current_Property.Reverse_Alias no_wrap /]>
											[/Clean][/Else]
										[/If]
									[/Clean][/Else]
								[/If]
							[/Clean][/Current_Item.Values.[Current_Property.Reverse_Alias No_Wrap /]]		
						[/Clean][/Current_Item.Attachment_Property]
				[/Clean]
				</[Current_Type.Alias no_wrap /]>
			{/Content}
		{/Template}
	
{/Jelly}